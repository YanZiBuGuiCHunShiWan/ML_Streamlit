import streamlit as st

def reinforcement_foundation():
    st.sidebar.markdown("## 10.1 å¼ºåŒ–å­¦ä¹ ç®€ä»‹")
    st.sidebar.markdown("## 10.2 å¼ºåŒ–å­¦ä¹ çš„æœ€ç»ˆç›®çš„")
    st.sidebar.markdown("### &emsp;10.2.1 ç­–ç•¥å’Œä»·å€¼å‡½æ•°")
    st.sidebar.markdown("### &emsp;10.2.2 æœ€ä¼˜ç­–ç•¥å’Œæœ€ä¼˜ä»·å€¼å‡½æ•°")
    st.markdown("### :blue[10.1å¼ºåŒ–å­¦ä¹ ç®€ä»‹]")
    st.markdown("### :blue[10.2å¼ºåŒ–å­¦ä¹ çš„æœ€ç»ˆç›®çš„]")
    st.latex(r'''\begin{aligned} G_t&=R_{t+1}+\gamma R_{t+2}+\gamma^2 R_{t+3}+ ... +\gamma^{T-1} R_{T} \\
        &=\sum_{i=0}\gamma^{i} R_{t+i+1}\end{aligned}''')
    st.markdown("&emsp;&emsp;æŠ˜æ‰£ç‡$\gamma$å†³å®šäº†æœªæ¥æ”¶ç›Šçš„ç°å€¼ï¼Œå¦‚æœ$\gamma$æ¥è¿‘äº$0$åˆ™è¯´æ˜æ™ºèƒ½ä½“ç›®å…‰çŸ­æµ…ï¼Œå› ä¸ºåæ•ˆçš„æ”¶ç›Šæ¥è¿‘äº$0$ã€‚è‹¥$\gamma$è¶‹å‘äº$1$ï¼Œåˆ™è¡¨æ˜\
        æ™ºèƒ½ä½“æœ‰è¿œè§ï¼Œèƒ½è€ƒè™‘é•¿è¿œæ”¶ç›Šã€‚")
    st.image("src/å¼ºåŒ–å­¦ä¹ 1_01.jpg")
    st.markdown("#### :blue[10.2.1 ç­–ç•¥å’Œä»·å€¼å‡½æ•°]")
    st.markdown("&emsp;&emsp;ä»·å€¼å‡½æ•°æ˜¯å…³äºçŠ¶æ€çš„å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦è¯„ä¼°å½“å‰æ™ºèƒ½ä½“åœ¨ç»™å®šçŠ¶æ€ä¸‹çš„ä¸€ä¸ªä¼˜åŠ£ï¼Œè€Œâ€˜ä¼˜åŠ£â€™æ˜¯ç”¨:blue[æœªæ¥é¢„æœŸçš„æ”¶ç›Š]æ¥å®šä¹‰çš„ã€‚ç®€å•è¯´æ¥å°±æ˜¯å›æŠ¥çš„æœŸæœ›å€¼ï¼Œ\
    æˆ‘ä»¬æŠŠç­–ç•¥$\pi$ä¸‹çŠ¶æ€$s$çš„ä»·å€¼å‡½æ•°è®°ä½œ$v_{\pi}(s)$ï¼Œå³ä»çŠ¶æ€$s$å¼€å§‹ï¼Œæ™ºèƒ½ä½“æŒ‰ç…§ç­–ç•¥$\pi$è¿›è¡Œå†³ç­–è·å¾—çš„å›æŠ¥çš„æœŸæœ›ã€‚æ­£å¼å®šä¹‰$v_{\pi}(s)$å¦‚ä¸‹ï¼š")
    st.latex(r'''\begin{aligned} v_{\pi}(s)â‰\mathbb E_{\pi}[G_t|S_t=s]=\mathbb E_{\pi}[\sum_{i=0}\gamma^{i} R_{t+i+1}|S_t=s],s\in \mathcal S\end{aligned} \tag{10.1}''')
    st.markdown("&emsp;&emsp;ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬æŠŠåœ¨ç­–ç•¥$\pi$ä¸‹çŠ¶æ€$s$æ—¶é‡‡ç”¨åŠ¨ä½œ$a$æ‰€è·å¾—çš„å›æŠ¥æœŸæœ›è®°ä½œ$q_{\pi}(s,a)$ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š")
    st.latex(r'''\begin{aligned}q_{\pi}(s,a)â‰\mathbb E_{\pi}[G_t|S_t=s,A_t=a]=\mathbb E_{\pi}[\sum_{i=0}\gamma^{i} R_{t+i+1}|S_t=s,A_t=a]\end{aligned} \tag{10.2}''')
    st.markdown("&emsp;&emsp;æ˜¾ç„¶ï¼Œ$v_{\pi}(s)$å’Œ$q_{\pi}(s,a)$æœ‰å¯†åˆ‡å…³ç³»ï¼Œç”±ä¸Šå›¾å¯çŸ¥ï¼ŒçŠ¶æ€$s$ä¸‹å¯é‡‡å–çš„åŠ¨ä½œ$s$æœ‰$|\mathcal S|$ä¸ªï¼Œæ¯ä¸ªåŠ¨ä½œ$a$éƒ½å¯¹åº”äºä¸€ä¸ª$q_{\pi}(s,a)$,\
        æ‰€ä»¥æœ‰:red[$v_{\pi}(s)=\sum_{a\in \mathcal A} \pi(a|s)q_{\pi}(s,a)$]ã€‚")
    st.markdown("&emsp;&emsp;åœ¨å¼ºåŒ–å­¦ä¹ ä¸åŠ¨æ€è§„åˆ’ä¸­ï¼Œä»·å€¼å‡½æ•°å®é™…ä¸Šæ˜¯æ»¡è¶³æŸç§é€’æ¨å…³ç³»çš„ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹åˆ°$q_{\pi}(s,a)$å’Œ$v_{\pi}(s)$å®é™…ä¸Šä¹Ÿæ˜¯æ»¡è¶³æŸç§å…³ç³»çš„ï¼Œæˆ‘ä»¬æ¥æ¨å¯¼ä¸€ä¸‹ï¼š")
    st.latex(r'''\begin{aligned} q_{\pi}(s,a)&=\sum_{s',r} p(s',r|s,a) [r+\gamma \mathbb E_{\pi}[G_{t+1}|S_{t+1}=s']] \\
            &=\sum_{s',r} p(s',r|s,a) [r+\gamma v_{\pi}(s')] \\
                &=\sum_{s',r} p(s',r|s,a) [r+\gamma \sum_{a'\in \mathcal A} \pi(a'|s')q_{\pi}(s',a')] \end{aligned} \tag{10.3}''')
    st.markdown("&emsp;&emsp;$10.3$çš„æ„æ€æ˜¯ï¼ˆç»“åˆå›¾çœ‹ï¼‰ï¼ŒåŠ¨ä½œ$a$äº§ç”ŸçŠ¶æ€$s'$ä¼šæœ‰ä¸€ä¸ªæ”¶ç›Š$r$ç„¶åå¾—åˆ°è¡°å‡äº†çš„$\gamma v_{\pi}(s)$ï¼Œä½†è¿™ä¸ª$r$å®é™…ä¸Šæ˜¯ä¸å›ºå®šçš„ï¼Œæœ‰å¾ˆå¤šä¸ªå¯èƒ½æ€§ï¼Œæ‰€ä»¥è¦å¯¹$r$åŠ æƒå¹³å‡ï¼Œè€Œ$s'$å–å€¼ä¹Ÿæœ‰$|\mathcal S|$ä¸ªï¼Œæ‰€ä»¥ä¹Ÿè¦åŠ æƒå¹³å‡ã€‚\
                æœ€ç»ˆçš„$v_{\pi}(s)$çš„é€’æ¨å¼è¡¨è¾¾å¦‚ä¸‹ï¼š")
    st.latex(r'''\begin{aligned} v_{\pi}(s) &=\sum_{a \in \mathcal A}\pi(a|s)\sum_{s',r} p(s',r|s,a) [r+\gamma \mathbb E_{\pi}[G_{t+1}|S_{t+1}=s']]\\
        &=\sum_{a \in \mathcal A}\pi(a|s)\sum_{s',r} p(s',r|s,a) [r+\gamma v_{\pi}(s')]\end{aligned} \tag{10.4}''')
    st.markdown("&emsp;&emsp;å¼å­$10.3$å’Œ$10.3$è¢«ç§°ä½œ:red[è´å°”æ›¼æœŸæœ›æ–¹ç¨‹]ï¼Œå…¶åˆ†åˆ«æè¿°äº†:red[åŠ¨ä½œä»·å€¼å’Œåç»§åŠ¨ä½œä»·å€¼ä¹‹é—´çš„å…³ç³»]ä»¥åŠ:red[çŠ¶æ€ä»·å€¼å’Œåç»§çŠ¶æ€ä»·å€¼ä¹‹é—´çš„å…³ç³»]ã€‚")
    with st.expander("ğŸ’¡:blue[Example1]ğŸ’¡"):
        st.markdown("æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªè®¡ç®—å®ä¾‹ã€‚")
    st.markdown("#### :blue[10.2.2 æœ€ä¼˜ç­–ç•¥å’Œæœ€ä¼˜ä»·å€¼å‡½æ•°]")
    st.markdown("&emsp;&emsp;å¼ºåŒ–å­¦ä¹ çš„æœ€ç»ˆç›®çš„å°±æ˜¯å»æ‰¾åˆ°æœ€ä¼˜çš„$\pi$ä½¿å¾—å›æŠ¥æœŸæœ›æœ€å¤§ï¼Œè€Œç®—æ³•ä¸­èƒ½ä¼˜åŒ–çš„ä¹Ÿåªæœ‰$\pi$ã€‚æˆ‘ä»¬å°†ä½¿å¾—ä»·å€¼å‡½æ•°è¾¾åˆ°æœ€å¤§ï¼Œæˆ‘ä»¬å°†æœ€ä¼˜çŠ¶æ€ä»·å€¼å‡½æ•°å’Œæœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š")
    st.latex(r'''\begin{aligned} v_{*}(s)&â‰ \max_{\pi} v_{\pi}(s) \\
        q_{*}(s,a)&â‰\max_{\pi} q_{\pi}(s,a)\end{aligned} \tag{10.5}''') 
    st.markdown("&emsp;&emsp;å°½ç®¡æœ€ä¼˜ç­–ç•¥ä¸æ­¢ä¸€ä¸ªï¼Œä½†æ˜¯æˆ‘ä»¬ç»Ÿä¸€è¡¨ç¤ºå¦‚ä¸‹ï¼Œå…¬å¼å«ä¹‰æ˜¯$\pi_{*}$å¯ä»¥ä½¿å¾—$v_{\pi}(s)$è¾¾åˆ°æœ€å¤§ä¹Ÿå¯ä»¥ä½¿$q_{\pi}(s,a)$è¾¾åˆ°æœ€å¤§ã€‚")
    st.latex(r'''\pi^*=\argmax_{\pi} v_{\pi}(s)=\argmax_{\pi} q_{\pi}(s,a) \tag{10.6}''')
    st.markdown("&emsp;&emsp;æœ€ä¼˜ç­–ç•¥ä¸‹çš„çŠ¶æ€ä»·å€¼å‡½æ•°ä¸€å®šç­‰äºè¿™ä¸ªçŠ¶æ€ä¸‹æœ€ä¼˜åŠ¨ä½œçš„æœŸæœ›å›æŠ¥ï¼Œ$v_*$çš„è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹å¦‚ä¸‹ï¼š")
    st.latex(r'''\begin{aligned} v_{*}(s)&=\max_{a \in \mathcal A} q_{\pi^*}(s,a) \\
        &=\max_a \sum_{s',r} p(s',r|s,a) [r+\gamma v_{\pi}(s')]\end{aligned} \tag{10.7}''')
    st.markdown("&emsp;&emsp;$q_*$çš„è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹å¦‚ä¸‹ï¼š")
    st.latex(r'''\begin{aligned}q_{*}(s,a)=\sum_{s',r} p(s',r|s,a) [r+\gamma \max_{a'\in \mathcal A}q_{*}(s',a')] \end{aligned} \tag{10.8}''')
    
    
def reinforcement_dynamic_programming():
    st.sidebar.markdown("## 10.2 åŠ¨æ€è§„åˆ’")
    st.sidebar.markdown("### &emsp;10.2.1 ç­–ç•¥è¯„ä¼°")
    st.sidebar.markdown("#### &emsp;&emsp;10.2.1.1è¿­ä»£ç­–ç•¥è¯„ä¼°")
    st.sidebar.markdown("### &emsp;10.2.2 ç­–ç•¥æ”¹è¿›")
    st.sidebar.markdown("### &emsp;10.2.2 ç­–ç•¥è¿­ä»£")
    st.sidebar.markdown("### &emsp;10.2.3 ä»·å€¼è¿­ä»£")
    st.sidebar.markdown("### &emsp;10.2.4 å¼‚æ­¥åŠ¨æ€è§„åˆ’")
    st.sidebar.markdown("### &emsp;10.2.5 å¹¿ä¹‰ç­–ç•¥è¿­ä»£")
    st.markdown("## :blue[10.2 åŠ¨æ€è§„åˆ’]")
    st.markdown("### :blue[10.2.1 ç­–ç•¥è¯„ä¼°]")
    st.markdown("&emsp;&emsp;æˆ‘ä»¬è¦è®¡ç®—å‡ºçŠ¶æ€ä»·å€¼å‡½æ•°æ¥æ‰èƒ½è¿›ä¸€æ­¥è¯„ä¼°ç­–ç•¥çš„å¥½åï¼Œå› æ­¤æ¥ä¸‹æ¥ä»‹ç»å¦‚ä½•è®¡ç®—å‡ºå…·ä½“çš„çŠ¶æ€ä»·å€¼å‡½æ•°ã€‚æˆ‘ä»¬çš„æ¡ä»¶æ˜¯ï¼šç»™å®š$MDP$ï¼Œ:red[å³æˆ‘ä»¬çŸ¥é“\
        $p(s',r|s,a)$å’Œç­–ç•¥$\pi$çš„æ¡ä»¶ä¸‹]æ±‚$v_{\pi}(s)$çš„è¡¨è¾¾å¼ã€‚ç”±å…ˆå‰$10.3$å¯çŸ¥ï¼š")
    st.latex(r'''\begin{aligned}v_{\pi}(s)&=\sum_{a \in \mathcal A}\pi(a|s)\sum_{s',r} p(s',r|s,a) [r+\gamma v_{\pi}(s')] \\
        &=\sum_{a \in \mathcal A}\pi(a|s)\sum_{s',r} rp(s',r|s,a)+\gamma \sum_{a \in \mathcal A}\pi(a|s) \sum_{s',r}p(s',r|s,a)v_{\pi}(s') \\
            &=\underbrace {\sum_{a \in \mathcal A}\pi(a|s)\sum_{r} rp(r|s,a)}_{\text{\textcircled a}}+\underbrace{\gamma \sum_{a \in \mathcal A}\pi(a|s)\sum_{s'} p(s'|s,a)v_{\pi}(s')}_{\text{\textcircled b}}\end{aligned}''')
    st.markdown("#### :blue[10.2.1.1 è¿­ä»£ç­–ç•¥è¯„ä¼°]")
    st.markdown("&emsp;&emsp;è§£æè§£è™½ç„¶èƒ½å†™å‡ºæ¥ï¼Œä½†æ˜¯ç›´æ¥æ±‚è§£æ—¶é—´å¤æ‚åº¦å¤ªé«˜äº†ï¼Œå› æ­¤é€šå¸¸ç”¨æ•°å€¼è§£æ¥æ±‚è§£æœ€ä¼˜ç­–ç•¥ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ±‚å‡ºï¼š")
    st.latex(r'''\mathbf v_{\pi}(s)=\begin{pmatrix} v_*(s_1)  \\ {\vdots} \\ v_*(s_{|\mathcal S|}) \end{pmatrix}''')
    st.markdown("&emsp;&emsp;åœ¨è¿­ä»£çš„ç­–ç•¥è¯„ä¼°ä¸­ï¼Œæˆ‘ä»¬åˆå§‹åŒ–ä¸€ç»„åºåˆ—$\{ v_k\}_{k=1}^{\infin}$ï¼Œç„¶åæŒ‰ç…§å¦‚ä¸‹æ–¹ç¨‹è¿›è¡Œæ›´æ–°ï¼š")
    st.latex(r'''\begin{aligned}v_{k+1}(s)&â‰\mathbb E_{\pi}[R_{t+1}+\gamma v_k(S_{t+1})|S_t=s] \\
        &=\sum_{a \in \mathcal A}\pi(a|s)\sum_{s',r} p(s',r|s,a) [r+\gamma v_{k}(s')]\end{aligned} \tag{10.9}''')
    st.markdown("&emsp;&emsp;æœ€ç»ˆä¸€å®šä¼šæ”¶æ•›åˆ°$v_{\pi}$ã€‚")
    st.markdown("### :blue[10.2.2 ç­–ç•¥æ”¹è¿›è§£]")
    
    st.markdown("&emsp;&emsp;å½“è®¡ç®—å‡ºäº†ä»·å€¼å‡½æ•°ï¼Œæˆ‘ä»¬å°±èƒ½è¯„ä¼°ç­–ç•¥çš„å¥½åï¼Œä½†å¯¹äºæŸä¸ªçŠ¶æ€ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“æ˜¯å¦åº”è¯¥é€‰æ‹©ä¸åŒäºç»™å®šçš„ç­–ç•¥çš„åŠ¨ä½œ$a \\neq \pi(s)$ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ¸…æ¥šé€‰æ‹©å…¶ä»–ç­–ç•¥ä»¥åå¾—åˆ°çš„ç»“æœä¼šæ›´å¥½è¿˜æ˜¯æ›´åã€‚\
        æœ€ç›´è§‚çš„åŠæ³•æ˜¯ï¼Œç›´æ¥è®¡ç®—$v_{\pi}(s)$å’Œæ–°ç­–ç•¥å¯¹åº”çš„$v_{\pi '}(s)$ï¼Œæ¯”è¾ƒäºŒè€…å¤§å°å°±çŸ¥é“ç­–ç•¥å¥½åï¼Œä½†æ˜¯å®é™…æƒ…å†µä¸‹è®¡ç®—æ–°çš„çŠ¶æ€å‡½æ•°æ˜¯è¦æ¶ˆè€—èµ„æºçš„ï¼Œæœ‰æ²¡æœ‰å…¶ä»–çš„åŠæ³•èƒ½æ›´ç®€æ´åœ°åˆ¤æ–­å‘¢ï¼Ÿ")
    st.markdown("&emsp;&emsp;æˆ‘ä»¬æœ‰:blue[ç­–ç•¥æ”¹è¿›å®šç†]èƒ½æ›´ç®€æ´åœ°å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•æ”¹è¿›ç­–ç•¥ã€‚å†…å®¹å¦‚ä¸‹ï¼šå¦‚æœ$\pi$å’Œ$\pi '$æ˜¯ä¸¤ä¸ªç¡®å®šçš„ç­–ç•¥ï¼Œå¦‚æœå¯¹äºä»»æ„$s \in \mathcal S$ï¼Œæˆ‘ä»¬æœ‰ï¼š")
    st.latex(r'''\begin{aligned} q_{\pi}(s,\pi '(s)) \geq v_{\pi}(s) \end{aligned}''')
    st.markdown("&emsp;&emsp;é‚£ä¹ˆç­–ç•¥$\pi '$ä¸€å®šä¸äºšäº$\pi$ï¼Œå³ï¼š")
    
    st.latex(r'''\begin{aligned} v_{\pi '}(s) \geq v_{\pi}(s) \\\end{aligned}''')
    with st.expander("è¯æ˜è¿‡ç¨‹å¦‚ä¸‹"):
        st.latex(r'''\begin{aligned}v_{\pi}(s)&\leq q_{\pi}(s,\pi'(s)) \\
            &=\mathbb E[R_{t+1} + \gamma v_{\pi}(S_{t+1})|S_t=s,A_t=\pi'(s)] \\
                &=\mathbb E_{\pi'}[R_{t+1} + \gamma v_{\pi}(S_{t+1})|S_t=s]\end{aligned}''')
        st.markdown("&emsp;&emsp;åˆ$v_{\pi}(S_{t+1}) \leq q_{\pi}(s,\pi'(S_{t+1})) $ï¼Œæ•…ä¸Šå¼å¯ä»¥ç¼©æ”¾æˆå¦‚ä¸‹ï¼š")
        st.latex(r'''\begin{aligned}v_{\pi}(s)&\leq \mathbb E_{\pi'}[R_{t+1} + \gamma q_{\pi}(S_{t+1},\pi'(S_{t+1}))|S_t=s] \\
            &=\mathbb E_{\pi'}[R_{t+1} + \gamma \mathbb E_{\pi'}[R_{t+2}+\gamma v_{\pi}(S_{t+2})|S_{t+1}]|S_t=s] \\
                &=\mathbb E_{\pi'}[R_{t+1} + \gamma R_{t+2}+\gamma^2 v_{\pi}(S_{t+2})|S_t=s]\end{aligned}''')
        st.markdown("&emsp;&emsp;ä¸Šå¼ä¹‹æ‰€ä»¥æˆç«‹æ˜¯å› ä¸º$\pi'$æ˜¯ä¸€ä¸ªç¡®å®šæ€§çš„ç­–ç•¥ï¼Œæ‰€ä»¥å¯¹ä¸­æ‹¬å·å†…çš„å…ƒç´ æ±‚æœŸæœ›è¿™ä¸ªæ“ä½œå¯ä»¥å¿½ç•¥ã€‚æ¥ç€ä¸æ–­æŒ‰ç…§ä¸Šå¼è§„å¾‹è¿›è¡Œç¼©æ”¾å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š")
        st.latex(r''' \begin{aligned} v_{\pi}(s)&\leq \mathbb E_{\pi'}[R_{t+1} + \gamma R_{t+2}+\gamma^2 v_{\pi}(S_{t+2})|S_t=s] \\
            &\leq \mathbb E_{\pi'}[R_{t+1} + \gamma R_{t+2}+\gamma^2 v_{\pi}(S_{t+2}) + \gamma^3 v_{\pi}(S_{t+3}) |S_t=s] \\
                &\vdots \\
                    &\leq \mathbb E_{\pi'}[R_{t+1} + \gamma R_{t+2}+\gamma^2 v_{\pi}(S_{t+2}) + \gamma^3 v_{\pi}(S_{t+3}) + \gamma^4 v_{\pi}(S_{t+4}) + \cdots |S_t=s] \\
                        &=v_{\pi'}(s)\end{aligned}''')
        
    st.markdown("&emsp;&emsp;æ—¢ç„¶æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ç­–ç•¥æ”¹è¿›å®šç†çŸ¥é“ç­–ç•¥çš„å¥½åï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ä»‹ç»å¦‚ä½•è¿›è¡Œç­–ç•¥æ”¹è¿›å¾—åˆ°æ›´å¤šçš„å›æŠ¥ã€‚è‡ªç„¶åœ°ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸€ä¸ªçŠ¶æ€$s$ä¸‹é€‰æ‹©æœ€ä¼˜çš„$q_{\pi}(s,a)$å³å¯ï¼Œå³æ–°çš„ç­–ç•¥$\pi'$æ»¡è¶³ï¼š")
    st.latex(r'''\begin{aligned} \pi'(s)&â‰\argmax_{a} q_{\pi}(s,a) \\
        &=\argmax_{a} \mathbb E[R_{t+1}+\gamma v_{\pi}(S_{t+1})|S_t=s,A_t=a] \\
            &=\argmax_{a} \sum_{s',r}p(s',r|s,a)(r+\gamma v_{\pi}(s'))\end{aligned} \tag{10.10}''')
    st.markdown("&emsp;&emsp;æ ¹æ®è¿™ç§è´ªå¿ƒç­–ç•¥æ”¹è¿›çš„ç­–ç•¥ä¸€å®šä¸äºšäºåŸç­–ç•¥ï¼Œå€˜è‹¥æ”¹è¿›åå¾—åˆ°çš„æ–°ç­–ç•¥å’ŒåŸç­–ç•¥ä¸€æ ·å¥½ï¼Œé‚£ä¹ˆä¸€å®šæœ‰$v_{\pi}$=$v_{\pi'}$ï¼Œä¸”å‡ä¸ºæœ€ä¼˜ç­–ç•¥ï¼Œç„¶æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆï¼š")
    st.latex(r''' \begin{aligned} v_{\pi}(s)=v_{\pi'}(s)&â‰\argmax_{a}q_{\pi}(s,a) \\ 
             &=\argmax_a q_{\pi}(s,\pi'(s)) \\
                 &=\argmax_a \sum_{s',r} p(r,s'|s,a)[r+\gamma v_{\pi}(s')]\end{aligned} \tag{10.11}''')
    st.markdown("&emsp;&emsp;å¼$10.11$å’Œå¼$10.7$è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹ä¸€æ ·ï¼Œæ‰€ä»¥è¯´$v_{\pi}=v_{\pi'}$æ—¶åŸç­–ç•¥$\pi$å’Œè´ªå¿ƒç­–ç•¥æ”¹è¿›å¾—åˆ°çš„æ–°ç­–ç•¥$\pi'$å°±æ˜¯æœ€ä¼˜çš„ç­–ç•¥ã€‚")
    
    st.markdown("### :blue[10.2.3 ç­–ç•¥è¿­ä»£]")
    st.markdown("&emsp;&emsp;æ‰€è°“ç­–ç•¥è¿­ä»£ï¼Œå°±æ˜¯æŒ‡è¿­ä»£åœ°æ‰¾åˆ°æœ€ä¼˜ç­–ç•¥$\pi_*$çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬åœ¨å‰é¢ä¸¤å°èŠ‚è®²äº†ç­–ç•¥è¯„ä¼°å’Œç­–ç•¥æ”¹è¿›ï¼Œå®é™…ä¸Šç­–ç•¥è¿­ä»£å°±æ˜¯è¿™ä¸¤ä¸ªè¿‡ç¨‹çš„ç»“åˆã€‚ä¸æ–­åœ°äº¤æ›¿ä¸¤ä¸ªè¿‡ç¨‹ä»è€Œæ‰¾åˆ°æœ€ä¼˜ç­–ç•¥ã€‚")
    st.latex(r'''\pi_0 \xrightarrow{Evaluate} v_{\pi_0} \xrightarrow{Improve} \pi_1 \xrightarrow{Evaluate} v_{\pi_1} \xrightarrow{Improve} \cdots \pi_* \xrightarrow{Evaluate} v_{\pi_*} ''')
    st.markdown("&emsp;&emsp;åœ¨æœ‰é™é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ä¸­ï¼Œæ•´ä¸ªå®šä¹‰ç©ºé—´éƒ½æ˜¯æœ‰é™çš„ï¼Œç­–ç•¥ä¹Ÿå¿…ç„¶æ˜¯æœ‰é™çš„ï¼Œåœ¨æˆ‘ä»¬çš„äº¤æ›¿è¿‡ç¨‹ä¸­ï¼Œå€¼å‡½æ•°å•è°ƒä¸Šå‡ä¸”æ˜¾ç„¶æœ‰ä¸Šç•Œï¼Œå½“ç­–ç•¥è¿­ä»£è¿‡ç¨‹æ‰§è¡Œä¸€å®šæ­¥æ•°åï¼Œç­–ç•¥å¿…ç„¶èƒ½æ”¶æ•›åˆ°æœ€ä¼˜ç­–ç•¥ã€‚ç­–ç•¥è¿­ä»£ç®—æ³•è¿‡ç¨‹å¯è§ä¸‹å›¾ï¼š")
    st.image("src/policy_iteration.png")
    st.markdown("&emsp;&emsp;å¯è§åœ¨ç­–ç•¥è¯„ä¼°è¿™ä¸€æ­¥è¦è¿›è¡Œä¸€ä¸ªå¾ªç¯ï¼Œç„¶ååˆ°äº†ç­–ç•¥æ”¹è¿›åˆè¦è¿›è¡Œä¸€ä¸ªå¾ªç¯ï¼Œæ‰€ä»¥åŸå§‹çš„ç­–ç•¥è¿­ä»£ç®—æ³•æ˜¯æ¯”è¾ƒè€—æ—¶é—´çš„ã€‚;å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä»·å€¼è¿­ä»£åªæ˜¯åœ¨ç­–ç•¥è¯„ä¼°è¿™ä¸€è¿‡ç¨‹ä¸­åªèµ°ä¸€æ­¥ï¼Œå¹¶ä¸ä»£è¡¨ä¸è¿›è¡Œç­–ç•¥æ”¹è¿›ã€‚")
    st.markdown("### :blue[10.2.4 ä»·å€¼è¿­ä»£] ")
    st.markdown("&emsp;&emsp;å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥æå‰æˆªæ–­ç­–ç•¥è¯„ä¼°è¿‡ç¨‹ï¼Œå¹¶ä¸”ä¸å½±å“å…¶æ”¶æ•›æ€§ï¼Œæœ€æç«¯çš„ä¸€ç§æƒ…å†µå°±æ˜¯åœ¨å¯¹æ¯ä¸ªçŠ¶æ€è¿›è¡Œä¸€æ¬¡\
        æ›´æ–°åå°±åœæ­¢ç­–ç•¥è¯„ä¼°ï¼Œè¯¥ç®—æ³•ç§°ä¸º:red[ä»·å€¼è¿­ä»£]ã€‚")
    st.latex(r'''\begin{aligned} v_{k+1}(s)&â‰\max_a\sum_{r,s'}p(s',r|r,s)(r+\gamma v_{k}(s')) \end{aligned} \tag{10.12}''')
    st.markdown("&emsp;&emsp;ç®—æ³•çš„å…·ä½“è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼šå®é™…ä¸Šå°±æ˜¯ç»“åˆäº†ç­–ç•¥è¯„ä¼°å’Œç­–ç•¥è¿­ä»£ï¼Œéå¸¸æš´åŠ›ã€‚å½“ç„¶ï¼Œ:red[å¯ä»¥è®¤ä¸ºä»·å€¼è¿­ä»£æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç­–ç•¥è¿­ä»£ã€‚]")
    st.image("src/value_iteration.png")
    st.markdown("## :blue[10.3 å¼‚æ­¥åŠ¨æ€è§„åˆ’]")
    st.markdown("&emsp;&emsp;åœ¨å‰è¿°çš„è¿­ä»£æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ¯èµ°ä¸€æ­¥ï¼Œéƒ½éœ€è¦å¯¹æ‰€æœ‰çš„$v_{\pi}(s),s\in\mathcal S$è¿›è¡Œæ›´æ–°ï¼Œå½“çŠ¶æ€ç©ºé—´éå¸¸å¤§æ—¶ï¼Œèµ°ä¸€æ­¥çš„è€—æ—¶ä¹Ÿæ˜¯éå¸¸é«˜çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸å»æ›´æ–°æ‰€æœ‰çš„çŠ¶æ€ï¼Œè€Œæ˜¯ä¼˜å…ˆæ›´æ–°æˆ‘ä»¬è®¤ä¸ºå€¼å¾—æ›´æ–°çš„çŠ¶æ€ï¼Œå¼‚æ­¥ä»·å€¼è¿­ä»£çš„å…¶ä¸­ä¸€ä¸ªç‰ˆæœ¬å°±æ˜¯\
        åˆ©ç”¨æˆªè‡³è¿­ä»£çš„æ›´æ–°å…¬å¼$10.12$ï¼Œåœ¨æ¯ä¸€æ­¥çš„åŸºç¡€ä¸Šåªæ›´æ–°ä¸€ä¸ªçŠ¶æ€$s_k$ã€‚å¦‚æœ$0\leq\gamma\leq 1$ï¼Œåˆ™åªè¦æ‰€æœ‰çŠ¶æ€éƒ½åœ¨åºåˆ—$\{v_k\}$ä¸­å‡ºç°æ— æ•°æ¬¡ï¼Œå°±èƒ½ä¿è¯æ¸è¿‘æ”¶æ•›åˆ°$v_*$ã€‚")
    st.markdown("## :blue[10.5 å¹¿ä¹‰ç­–ç•¥è¿­ä»£]")
    st.image("src/GPI.png")
    st.markdown("&emsp;&emsp;å¹¿ä¹‰ç­–ç•¥è¿­ä»£(Generalized Policy Iteration (GPI))å°±æ˜¯æè¿°ç­–ç•¥è¯„ä¼°å’Œç­–ç•¥æ”¹è¿›äº¤æ›¿è¿›è¡Œçš„è¿‡ç¨‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¼ºåŒ–å­¦ä¹ æ–¹æ³•éƒ½èƒ½å¾ˆå¥½åœ°è¢«æè¿°ä¸º GPI æ¨¡å‹ã€‚\
       ")
    st.markdown("&emsp;&emsp; å¹¿ä¹‰ç­–ç•¥è¿­ä»£ä¸­çš„ç­–ç•¥è¯„ä¼°å’Œç­–ç•¥æ”¹è¿›çš„è¿‡ç¨‹å°±å¦‚åŒ'ç«äº‰å’Œåä½œ'çš„å…³ç³»ï¼Œè¯„ä¼°è¿‡ç¨‹æ—¨åœ¨æä¾›å‡†ç¡®çš„ä¿¡æ¯å’Œåé¦ˆï¼Œä»¥ä¾¿äºåˆ¶å®šæ”¹è¿›ç­–ç•¥çš„å†³ç­–ï¼Œç­–ç•¥æ”¹è¿›çš„ç›®æ ‡æ˜¯å¯»æ‰¾æ›´å¥½çš„ç­–ç•¥æ¥æœ€å¤§åŒ–æ€§èƒ½ã€‚å®ƒå¯ä»¥é‡‡ç”¨ä¸åŒçš„æ–¹æ³•ï¼Œå¦‚ä»·å€¼è¿­ä»£ã€ç­–ç•¥è¿­ä»£æˆ–è’™ç‰¹å¡æ´›æ–¹æ³•ç­‰ï¼Œä»¥æœç´¢æ›´ä¼˜çš„è¡ŒåŠ¨æˆ–ç­–ç•¥ã€‚æ”¹è¿›è¿‡ç¨‹ä¼šå°è¯•æ¢ç´¢å…¶ä»–å¯èƒ½çš„ç­–ç•¥ï¼Œå¹¶ä¸å½“å‰ç­–ç•¥è¿›è¡Œæ¯”è¾ƒï¼Œä»¥ç¡®å®šå“ªäº›è¡ŒåŠ¨æˆ–ç­–ç•¥æ›´èƒ½æé«˜æ€§èƒ½ï¼Œè¿™æ˜¯äºŒè€…é—´'ç«äº‰æ€§'çš„ä½“ç°ï¼Œ\
        å¦ä¸€æ–¹é¢ï¼Œè¯„ä¼°è¿‡ç¨‹æä¾›äº†æ”¹è¿›è¿‡ç¨‹æ‰€éœ€çš„å…³é”®ä¿¡æ¯å’ŒæŒ‡å¯¼ï¼Œå¸®åŠ©ç¡®å®šæ”¹è¿›çš„æ–¹å‘ã€‚æ”¹è¿›è¿‡ç¨‹çš„ç»“æœåˆä¼šè¢«ç”¨äºè¯„ä¼°è¿‡ç¨‹ä¸­éªŒè¯å’Œç¡®å®šæ”¹è¿›åçš„ç­–ç•¥çš„ä¼˜åŠ£ã€‚é€šè¿‡å¾ªç¯è¿­ä»£å¹¶ç›¸äº’åä½œï¼Œè¯„ä¼°å’Œæ”¹è¿›è¿‡ç¨‹å…±åŒä¿ƒè¿›äº†ç­–ç•¥çš„ä¼˜åŒ–ã€‚")
    
def reinforcement_montecarlo():
    st.markdown("## :blue[10.3 è’™ç‰¹å¡æ´›æ–¹æ³•]")
    st.markdown("&emsp;&emsp;åœ¨å‰ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ çš„æ˜¯å¦‚ä½•åˆ©ç”¨åŠ¨æ€è§„åˆ’çš„æ–¹å¼æ±‚è§£å‡ºæœ€ç»ˆçš„ç­–ç•¥$\pi$ï¼Œè¿™ç§æ–¹æ³•æœ‰ä¸€ä¸ª:red[å‰æå°±æ˜¯åŠ¨æ€ç‰¹æ€§$p(r,s'|s,a)$å¿…é¡»å·²çŸ¥ã€‚]ä½†æ˜¯åœ¨ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¾ˆéš¾å¾—åˆ°æ˜¾ç¤ºçš„åˆ†å¸ƒï¼Œä½†æ˜¯ä»å¸Œæœ›çš„åˆ†å¸ƒè¿›è¡Œé‡‡æ ·åˆ™è¾ƒä¸ºå®¹æ˜“ã€‚")
    st.markdown("&emsp;&emsp;æˆ‘ä»¬çŸ¥é“çŠ¶æ€ä»·å€¼å‡½æ•°æ˜¯ä»è¯¥çŠ¶æ€å¼€å§‹çš„æœŸæœ›å›æŠ¥ï¼Œè™½ç„¶æˆ‘ä»¬ä¸çŸ¥é“åŠ¨æ€ç‰¹æ€§ï¼Œä½†æ˜¯å¦‚æœæœ‰å›æŠ¥çš„è§‚æµ‹å€¼å³ç»éªŒï¼Œé‚£ä¹ˆéšç€è¶Šæ¥è¶Šå¤šçš„å›æŠ¥è¢«è§‚æµ‹åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å›æŠ¥çš„å‡å€¼æ¥è¿‘ä¼¼çŠ¶æ€ä»·å€¼ã€‚è¿™å°±æ˜¯è’™ç‰¹å¡æ´›æ–¹æ³•çš„æ€æƒ³ã€‚")
    st.markdown("### :blue[10.2.1 çŠ¶æ€ä»·å€¼çš„ä¼°è®¡] ")
    st.markdown("- **é¦–æ¬¡è®¿é—®å‹ä¼°è®¡** ")
    st.markdown("&emsp;&emsp;å‡è®¾ç»™å®šç­–ç•¥$\pi$ä¸‹é€”å¾„çŠ¶æ€$s$çš„å¤šå¹•æ•°æ®ï¼Œè¿™ç»„å¤šå¹•æ•°æ®ä¸­ï¼ŒçŠ¶æ€$s$å¯èƒ½ä¼šè¢«å¤šæ¬¡è®¿é—®åˆ°ï¼Œæˆ‘ä»¬ç§°ç¬¬ä¸€æ¬¡è®¿é—®ä¸º$s$çš„æ˜¯$s$**çš„é¦–æ¬¡è®¿é—®**ã€‚è€Œé¦–æ¬¡è®¿é—®å‹MCç®—æ³•å°±æ˜¯ç”¨çŠ¶æ€$s$çš„æ‰€æœ‰é¦–æ¬¡è®¿é—®çš„å›æŠ¥çš„å¹³å‡å€¼ä¼°è®¡$v_{\pi}(s)$ã€‚\
        å³$v_{\pi}(s) \\approx \\frac{1}{N} \\sum_{i=1}^N G_t^{(i)}$ã€‚")
    st.markdown("&emsp;&emsp;ä¸‹å›¾å±•ç¤ºçš„æ˜¯é¦–æ¬¡è®¿é—®å‹MCä¼°è®¡çŠ¶æ€ä»·å€¼çš„åŸç†ï¼š")
    st.image("src/mc_value.jpg")
    st.markdown("&emsp;&emsp;ä¼ªä»£ç å¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬åªè®¡ç®—æ¯ä¸€å¹•æ•°æ®ä¸­çŠ¶æ€$s$é¦–æ¬¡å‡ºç°åçš„å›æŠ¥çš„æœŸæœ›ï¼Œå½“è¿™ä¸€å¹•æ•°æ®ä¸­å†æ¬¡é‡åˆ°çŠ¶æ€$s$æ—¶ï¼Œæˆ‘ä»¬å¿½ç•¥ã€‚")
    st.image("src/mc_value_pscode.png")
    st.markdown("- **æ¯æ¬¡è®¿é—®å‹ä¼°è®¡** ")
    
    st.markdown("### :blue[10.2.2 åŠ¨ä½œä»·å€¼çš„ä¼°è®¡] ")
    st.markdown("&emsp;&emsp;å’ŒçŠ¶æ€ä»·å€¼ä¼°è®¡ç±»ä¼¼ï¼ŒåŠ¨ä½œä»·å€¼çš„è’™ç‰¹å¡æ´›ä¼°è®¡éœ€è¦å¯¹â€œçŠ¶æ€-åŠ¨ä½œâ€äºŒå…ƒç»„$(s,a)$è®¿é—®ï¼Œé¦–æ¬¡è®¿é—®å‹MCåˆ™ä¼šå°†æ¯ä¸€å¹•é¦–æ¬¡è®¿é—®åˆ°è¿™ä¸ªâ€œçŠ¶æ€-åŠ¨ä½œâ€\
        äºŒå…ƒç»„å¾—åˆ°çš„å›æŠ¥çš„å¹³å‡å€¼ä½œä¸ºåŠ¨ä½œä»·å€¼çš„è¿‘ä¼¼ã€‚å’Œå…ˆå‰ä¸€æ ·ï¼Œå½“å¯¹æ¯ä¸ªâ€œåŠ¨ä½œ-ä»·å€¼â€äºŒå…ƒç»„çš„è®¿é—®æ¬¡æ•°è¶‹å‘äºæ— ç©·æ—¶ï¼Œè¿™äº›æ–¹æ³•ä¼šæ”¶æ•›åˆ°åŠ¨ä½œä»·å€¼å‡½æ•°çš„çœŸå®æœŸæœ›å€¼ã€‚")
    st.markdown("&emsp;&emsp;è™½ç„¶æƒ³æ³•å¾ˆå¥½ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½å¿½ç•¥è¿™æ ·çš„ä¸€ä¸ªå¯èƒ½æ€§ï¼Œå³æŸä¸€é¡¹â€œåŠ¨ä½œ-çŠ¶æ€â€äºŒå…ƒç»„æ˜¯æ°¸è¿œä¸ä¼šè¢«è®¿é—®åˆ°çš„ï¼Œå› ä¸º$\pi$æ˜¯ä¸€ä¸ªç¡®å®šæ€§ç­–ç•¥æ—¶ï¼Œé‚£ä¹ˆéµå¾ªè¯¥ç¡®å®šæ€§ç­–ç•¥æ„å‘³ç€\
        æ¯ä¸€ä¸ªçŠ¶æ€åªä¼šè§‚æµ‹åˆ°ä¸€ä¸ªç¡®å®šåŠ¨ä½œçš„å›æŠ¥ï¼Œåœ¨æ— æ³•è·å–å…¶ä»–åŠ¨ä½œçš„å›æŠ¥æ—¶è’™ç‰¹å¡æ´›ç®—æ³•æ— æ³•æ ¹æ®ç»éªŒæ”¹å–„åŠ¨ä½œä»·å€¼å‡½æ•°çš„ä¼°è®¡ã€‚")
    st.markdown("&emsp;&emsp;ä¸ºå®ç°åŠ¨ä½œä»·å€¼å‡½æ•°çš„ä¼°è®¡ï¼Œæˆ‘ä»¬æœ‰:blue[**è¯•æ¢æ€§å‡ºå‘å‡è®¾**]ï¼Œå³æ‰€æœ‰çš„â€œåŠ¨ä½œ-çŠ¶æ€â€äºŒå…ƒç»„éƒ½æœ‰éé›¶çš„æ¦‚ç‡è¢«é€‰æ‹©ä¸ºä¸€å¹•æ•°æ®çš„èµ·ç‚¹ï¼Œè¿™æ ·å¯ä»¥ä¿è¯\
                åœ¨é‡‡æ ·çš„å¹•æ•°è¶‹äºæ— ç©·æ—¶ï¼Œæ¯ä¸€ä¸ªâ€œåŠ¨ä½œ-çŠ¶æ€â€äºŒå…ƒç»„éƒ½ä¼šè¢«è®¿é—®åˆ°æ— æ•°æ¬¡ã€‚ä½†æ˜¯åœ¨çœŸå®ç¯å¢ƒä¸‹ï¼Œåˆ¶é€ æ»¡è¶³è¯¥å‡è®¾çš„æ¡ä»¶å¯èƒ½æ ¹æœ¬æ²¡æœ‰åŠæ³•åšåˆ°ï¼Œå› æ­¤è¯•æ¢æ€§å‡ºå‘å‡è®¾åªæ˜¯ç†è®ºä¸Šèƒ½åšåˆ°ã€‚\
                    æƒ³è¦çœŸæ­£çš„ä¼°è®¡åŠ¨ä½œä»·å€¼å‡½æ•°ï¼Œé‚£ä¹ˆ:blue[**æ— é™å¹•æ•°æ®**]å’Œ:blue[**æ»¡è¶³è¯•æ¢æ€§å‡ºå‘å‡è®¾**]è¿™ä¸¤ç‚¹æ˜¯å¿…é¡»è¦å…‹æœçš„ã€‚")
    st.markdown("### :blue[10.2.3 è’™ç‰¹å¡æ´›æ§åˆ¶]")
    st.markdown("&emsp;&emsp;:red[ä¸ºäº†å¾—åˆ°ä¸€ä¸ªå®é™…å¯åº”ç”¨çš„ç®—æ³•ï¼Œæˆ‘ä»¬å¿…é¡»æƒ³åŠæ³•å»é™¤è¿™ä¸¤ä¸ªå‡è®¾]ã€‚æˆ‘ä»¬å…ˆä¿ç•™è¯•æ¢æ€§å‡è®¾å‡ºå‘æ¥å®Œæˆå®Œæ•´çš„è’™ç‰¹å¡æ´›æ§åˆ¶(åœ¨è¿™é‡Œå°†è’™ç‰¹å¡æ´›é‡‡æ ·ç§°ä½œè’™ç‰¹å¡æ´›æ§åˆ¶)ã€‚åœ¨è¿›è¡Œç­–ç•¥è¯„ä¼°æ—¶çš„æ— é™å¤šå¹•æ•°æ®è¿™ä¸€å‡è®¾ï¼Œå®é™…ä¸Šæ¯”è¾ƒå¥½å»é™¤ã€‚\
        å’Œä»·å€¼è¿­ä»£çš„æ€æƒ³ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¸æœŸæœ›åŠ¨ä½œä»·å€¼å‡½æ•°è¦ç»è¿‡å¾ˆå¤šæ­¥çš„è¿­ä»£åæ¥è¿‘çœŸå®å€¼ï¼Œè€Œæ˜¯æ¯ä¸€å¹•ç»“æŸåä½¿ç”¨è§‚æµ‹åˆ°çš„å›æŠ¥è¿›è¡Œç­–ç•¥è¯„ä¼°ï¼Œç„¶ååœ¨æ”¹å¹•åºåˆ—è®¿é—®åˆ°çš„æ¯ä¸€ä¸ªçŠ¶æ€ä¸Šè¿›è¡Œç­–ç•¥æ”¹è¿›ã€‚ç­–ç•¥æ”¹è¿›\
            å°±æ˜¯ä¸Šä¸€ç« çš„è´ªå¿ƒç­–ç•¥ï¼Œå³$\pi'(s)=\\argmax_{a} q_{\pi}(s,a)$ã€‚")
    st.markdown("### :blue[10.2.4 æ²¡æœ‰è¯•æ¢æ€§å‡ºå‘å‡è®¾çš„è’™ç‰¹å¡æ´›æ§åˆ¶]")
    st.markdown("&emsp;&emsp;ä¸ºäº†ç»•å¼€éš¾ä»¥æ»¡è¶³çš„è¯•æ¢æ€§å‡ºå‘å‡è®¾ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•ï¼šï¼ˆ1ï¼‰åŒè½¨ç­–ç•¥$(on-policy)$ ï¼ˆ2ï¼‰ç¦»è½¨ç­–ç•¥$(off-policy)$ã€‚åœ¨åŒå½’ç­–ç•¥ä¸­ï¼Œ:red[ç”¨äºç”Ÿæˆé‡‡æ ·æ•°æ®åºåˆ—çš„ç­–ç•¥\
        å’Œç”¨äºå®é™…å†³ç­–çš„å¾…è¯„ä¼°ä¸æ”¹è¿›çš„ç­–ç•¥æ˜¯ç›¸åŒçš„]ï¼›åœ¨ç¦»è½¨ç­–ç•¥ä¸­ï¼Œ:red[ç”¨äºè¯„ä¼°å’Œæ”¹è¿›çš„ç­–ç•¥ä¸ç”Ÿæˆé‡‡æ ·æ•°æ®çš„ç­–ç•¥æ˜¯ä¸åŒçš„]ã€‚")
    st.markdown("&emsp;&emsp;åœ¨åŒè½¨ç­–ç•¥ä¸­ï¼Œç­–ç•¥ä¸€èˆ¬éƒ½æ˜¯è½¯æ€§çš„ï¼Œå³$\\forall s \in \mathcal S,a \in \mathcal A$æœ‰$\pi(a|s)\gt 0$ã€‚å®ƒä»¬ä¼šæ¸æ¸åœ°é€¼è¿‘ç¡®å®šæ€§çš„ç­–ç•¥ï¼Œä¸‹é¢ä»‹ç»çš„åŒè½¨ç­–ç•¥æ–¹æ³•\
        ç§°ä¸º:blue[$\\varepsilon$-è´ªå¿ƒç­–ç•¥]ï¼š")
    st.latex(r'''\pi^{\prime}(a \mid s)=\left\{\begin{array}{ll}
       1-\varepsilon+\frac{\varepsilon}{|\mathcal{A}(s)|} & , if \text { } a=a^*=\argmax_aq_{\pi}(s,a)\\
        \frac{\varepsilon}{|\mathcal{A}(s)|} & , \text { otherwise }    
        \end{array}\right. \tag{10.13}''')
    st.markdown("&emsp;&emsp;æœ‰äº†è¿™ä¸ªç­–ç•¥ï¼Œæˆ‘ä»¬å½“ç„¶éœ€è¦æ¯”è¾ƒè¿™ä¸ªç­–ç•¥å’ŒåŸæœ‰ç­–ç•¥çš„å¥½åï¼Œå’Œç­–ç•¥è¯„ä¼°é‚£ä¸€ç« ä¸€æ ·ï¼Œæˆ‘ä»¬æ¯”è¾ƒ$q_{\pi}(s,\pi'(s))$å’Œ$v_{\pi}(s)$çš„å¤§å°ã€‚")
    st.latex(r'''\begin{aligned} q_{\pi}(s,\pi'(s))&=\sum_{a}\pi(a|s)q_{\pi}(s,a) \\
        &=\frac{\varepsilon}{|\mathcal{A}(s)|} \sum_{a} q_{\pi}(s, a)+(1-\varepsilon) \max _{a} q_{\pi}(s, a) \end{aligned} \tag{10.14}''')
    st.markdown("&emsp;&emsp;æˆ‘ä»¬çš„ç›®çš„æ˜¯æ¯”è¾ƒå¤§å°ï¼Œè€Œæ¯”è¾ƒå¤§å°è‚¯å®šæ¶‰åŠåˆ°ç¼©æ”¾ï¼Œè€Œç¼©æ”¾åˆ™ä¼šè‡ªç„¶åœ°æƒ³åˆ°åœ¨$\max$è¿™ä¸ªç¬¦å·é¡¹åšæ–‡ç« ã€‚å¯ä»¥ç¡®å®šçš„æ˜¯$\max_{a}q_{\pi}(s,a)\geq q_{\pi}(s,a)$ã€‚")
    st.latex(r'''\begin{aligned} 1=\frac{\sum_a \pi(a|s)-\frac{\varepsilon}{|\mathcal A(s)|}}{1-\varepsilon}  \end{aligned} ''')
    st.markdown("&emsp;&emsp;æ•…æœ‰ï¼š")
    st.latex(r'''\begin{aligned}({1-\varepsilon})\max_{a}q_{\pi}(s,a)&\geq ({\sum_a \pi(a|s)-\frac{\varepsilon}{|\mathcal A(s)|}})q_{\pi}(s,a)\\
        &={\sum_a \pi(a|s)q_{\pi}(s,a)-\frac{\varepsilon}{|\mathcal A(s)|}}q_{\pi}(s,a)\end{aligned} ''')
    st.markdown("&emsp;&emsp;ä¸Šè¿°ç»“æœå¸¦å…¥åˆ°$10.14$åˆ™æœ‰ï¼š")
    st.latex(r'''\begin{aligned} q_{\pi}(s,\pi'(s))&=\frac{\varepsilon}{|\mathcal{A}(s)|} \sum_{a} q_{\pi}(s, a)+(1-\varepsilon) \max _{a} q_{\pi}(s, a) \\
            &\geq \frac{\varepsilon}{|\mathcal{A}(s)|} \sum_{a} q_{\pi}(s, a) + {\sum_a \pi(a|s)q_{\pi}(s,a)-\frac{\varepsilon}{|\mathcal A(s)|}}q_{\pi}(s,a) \\
                &= \sum_a \pi(a|s)q_{\pi}(s,a) \\
                    &= v_{\pi}(s) \end{aligned} \tag{10.15}''')
    st.markdown("&emsp;&emsp;æ•…æœ‰$\pi' \geq \pi$ã€‚")
    st.markdown("### :blue[10.2.5 åŸºäºé‡è¦åº¦é‡‡æ ·çš„ç¦»è½¨ç­–ç•¥]")
    st.markdown("&emsp;&emsp;å‡ ä¹æ‰€æœ‰çš„ç¦»è½¨ç­–ç•¥æ–¹æ³•éƒ½é‡‡ç”¨äº†é‡è¦åº¦é‡‡æ ·ï¼Œå¯¹äºä¸€å¹•æ•°æ®è€Œè¨€ï¼Œå…¶å­åºåˆ—çš„æ¦‚ç‡ä¸ºï¼š")
    st.image("src/RL-off-policy.png")
    st.markdown("&emsp;&emsp;ç»™å®šèµ·å§‹çŠ¶æ€$S_t$ï¼Œåç»­:red[çŠ¶æ€-åŠ¨ä½œ]è½¨è¿¹ä¸º$A_t,S_{t+1},...,S_T$åœ¨ç­–ç•¥$\pi$ä¸‹å‘ç”Ÿçš„æ¦‚ç‡æ˜¯ï¼š")
    st.latex(r'''\begin{aligned} &Pr\{ A_t,S_{t+1},A_{t+1},...,S_T|S_t,A_{t:T-1}\sim \pi\} \\
        &= \pi(A_t|S_t)p(S_{t+1}|A_t,S_t)\pi(A_{t+1}|S_{t+1})......\pi(A_{T-1}|S_{T-1})p(S_T|S_{T-1},A_{T-1}) \\
            &=\prod_{k=t}^{T-1} \pi(A_k|S_k)p(S_{k+1}|A_k,S_k) \end{aligned} ''')
    st.markdown("&emsp;&emsp;åŒç†ï¼Œåœ¨ç­–ç•¥$b$ä¸‹åŠ¨ä½œ-çŠ¶æ€åºåˆ—å‡ºç°çš„æ¦‚ç‡ä¸ºï¼š")
    st.latex(r'''\begin{aligned} &Pr\{ A_t,S_{t+1},A_{t+1},...,S_T|S_t,A_{t:T-1}\sim b\} \\
        &= b(A_t|S_t)p(S_{t+1}|A_t,S_t)b(A_{t+1}|S_{t+1})......b(A_{T-1}|S_{T-1})p(S_T|S_{T-1},A_{T-1}) \\
            &=\prod_{k=t}^{T-1} b(A_k|S_k)p(S_{k+1}|A_k,S_k) \end{aligned}''')
    st.markdown("&emsp;&emsp;å¯¹åº”çš„ç›®æ ‡ç­–ç•¥å’Œè¡ŒåŠ¨ç­–ç•¥è½¨è¿¹ä¸‹çš„ç›¸å¯¹æ¦‚ç‡ï¼ˆé‡è¦åº¦é‡‡ç”¨æ¯”ï¼‰æ˜¯ï¼š")
    st.latex(r'''\rho_{t:T-1}â‰\frac{\prod_{k=t}^{T-1} \pi(A_k|S_k)p(S_{k+1}|A_k,S_k)}{\prod_{k=t}^{T-1} b(A_k|S_k)p(S_{k+1}|A_k,S_k)} \
        = \prod_{k=t}^{T-1}\frac{\pi(A_k|S_k)}{b(A_k|S_k)} ''')
    st.markdown("&emsp;&emsp;å¯ä»¥çœ‹åˆ°ï¼Œå’ŒåŠ¨æ€ç‰¹æ€§$p$æœ‰å…³çš„é¡¹éƒ½æ¶ˆæ‰äº†ï¼Œæ‰€ä»¥é‡è¦åº¦é‡‡æ ·æ¯”åªå’Œç­–ç•¥ä¸æ ·æœ¬æ•°æ®ç›¸å…³ï¼Œä¸åŠ¨æ€ç‰¹æ€§æ— å…³ã€‚æœ‰äº†å‰é¢çš„å‡†å¤‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ¨å‡ºï¼š")
    st.latex(r'''\begin{aligned} v_{\pi}(s)&=\mathbb E_{\pi}[G_t|St=s] \\
        &=\mathbb E_b[\rho_{t:T-1}G_t|St=s]\end{aligned} ''')
    st.markdown("&emsp;&emsp;å¦‚æœè§‚å¯Ÿåˆ°äº†ä¸€æ‰¹éµå¾ªç­–ç•¥$b$ç”Ÿæˆçš„å¤šå¹•é‡‡æ ·åºåˆ—ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨å…¶å›æŠ¥è¿›è¡Œå¹³å‡æ¥ä¼°è®¡$v_{\pi}(s)$ã€‚å¯¹äºæ¯æ¬¡è®¿é—®å‹æ–¹æ³•ï¼Œæˆ‘ä»¬å®šä¹‰æ‰€æœ‰è®¿é—®è¿‡çŠ¶æ€$s$çš„æ—¶åˆ»é›†åˆä¸º$\mathcal T(s)$:blue[ï¼ˆå¯¹äºé¦–æ¬¡è®¿é—®å‹è€Œè¨€ï¼Œ$\mathcal T$åªåŒ…å«äº†é¦–æ¬¡è®¿é—®åˆ°$s$çš„æ—¶åˆ»ï¼‰]ã€‚\
        å°†æ—¶åˆ»$t$åçš„é¦–æ¬¡ç»ˆæ­¢è¡¨ç¤ºä¸º$T(t)$ï¼Œ$G_t$è¡¨ç¤ºåœ¨$t$ä¹‹ååˆ°è¾¾$T(t)$æ—¶çš„å›æŠ¥å€¼ï¼Œé‚£ä¹ˆ$\{ G_t\}_{t \in \mathcal T(s)}$åˆ™æ˜¯çŠ¶æ€$s$å¯¹åº”çš„å›æŠ¥å€¼ï¼Œ$\{ \\rho_{t:T(t)-1} \}$æ˜¯ç›¸åº”çš„é‡è¦åº¦é‡‡æ ·æ¯”é›†åˆï¼Œé‚£ä¹ˆ$v_{\pi}(s)$\
        å°±å¯ä»¥ç”¨é‡è¦åº¦é‡‡æ ·æ¯”è°ƒæ•´å›æŠ¥å€¼è¿›è¡Œå¹³å‡å³å¯ï¼š")
    st.latex(r'''V(s)â‰\frac{\sum_{t \in \mathcal T(s)}\rho_{t:T(t)-1}G_t}{|\mathcal T(s)|} \tag{10.16}''')
    st.markdown("&emsp;&emsp;ä¸Šè¿°æ–¹æ³•æ˜¯ç®€å•åŠ æƒå¹³å‡ï¼Œä¼˜ç‚¹æ˜¯ï¼šæ— åä¼°è®¡ï¼Œç¼ºç‚¹æ˜¯ï¼šæ–¹å·®è¾ƒå¤§ã€ä¸ç¨³å®šã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯åŠ æƒé‡è¦åº¦é‡‡æ ·ï¼Œå…¶å®šä¹‰ä¸ºï¼š")
    st.latex(r'''V(s)â‰\frac{\sum_{t \in \mathcal T(s)}\rho_{t:T(t)-1}G_t}{\sum_{t \in \mathcal T(s)}\rho_{t:T(t)-1}} \tag{10.17}''')
    st.markdown("&emsp;&emsp;è¯¥æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ï¼šå¯¹$v_{\pi}(s)$æ˜¯æ— åä¼°è®¡ï¼Œä¼˜ç‚¹æ˜¯ï¼šæ–¹å·®å°ï¼Œè¾ƒç¨³å®šã€‚")
    st.image("src/RL-variance.png")
    st.markdown("&emsp;&emsp;ä¸Šå›¾æ˜¯ä¸€ä¸ªå¸¦ç¯åºåˆ—è½¨è¿¹çš„ä¾‹å­ï¼Œå›¾ä¸­åªæœ‰ä¸€ä¸ªéç»ˆæ­¢çŠ¶æ€$s$å’Œå·¦å³ä¸¤ç§åŠ¨ä½œï¼Œé‡‡å–å‘å·¦çš„åŠ¨ä½œæœ‰0.1çš„æ¦‚ç‡è½¬ç§»åˆ°ç»ˆæ­¢çŠ¶æ€å¹¶å¾—åˆ°æ”¶ç›Š1ï¼Œæœ‰0.9çš„æ¦‚ç‡\
        è½¬ç§»å›$s$çŠ¶æ€ä¸”æ²¡æœ‰æ”¶ç›Šã€‚å‘å³çš„åŠ¨ä½œåˆ™å¿…å®šè½¬ç§»åˆ°ç»ˆæ­¢çŠ¶æ€ä¸”æ²¡æœ‰æ”¶ç›Šã€‚å›¾ä¸­çš„æ›²çº¿æ˜¯åŸºäºæ™®é€šé‡è¦åº¦é‡‡æ ·çš„é¦–æ¬¡è®¿é—®å‹MCç®—æ³•çš„10æ¬¡ç‹¬ç«‹è¿è¡Œçš„ç»“æœã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•è®¡ç®—æ¥ç¡®è®¤:red[ç»è¿‡é‡è¦åº¦é‡‡æ ·æ¯”åŠ æƒçš„å›æŠ¥çš„æ–¹å·®æ˜¯æ— ç©·çš„ã€‚]")
    st.latex(r'''\mathbf {Var[\rho_{t:T-1}G_t]}=\mathbb {E}[(\rho_{t:T-1}G_t)^2]-{E}[\rho_{t:T-1}G_t]^2 \tag{10.18}''')
    st.markdown("&emsp;&emsp;ä¸Šå¼çš„å³åŠéƒ¨åˆ†æ˜¯æœŸæœ›çš„å¹³æ–¹ï¼Œè‚¯å®šæ˜¯æœ‰ç•Œçš„ã€‚è€Œå·¦åŠéƒ¨åˆ†å¹³æ–¹çš„æœŸæœ›åˆ™éœ€è¦è¯æ˜æ˜¯æœ‰ç•Œè¿˜æ˜¯æ— ç•Œã€‚")
    st.latex(r'''\begin{aligned} \mathbb {E}_b[\rho_{t:T-1}G_t ^2] &= \mathbb {E}_b[(\prod_{t=0}^{T-1}\frac{\pi(A_t|S_t)}{S(A_t|S_t)}G_0)^2] \\
        &=\frac{1}{2}\cdotp 0.1(\frac{1}{0.5})^2 \\
            &+\frac{1}{2}\cdotp 0.9\cdot \frac{1}{2}\cdot 0.1(\frac{1}{0.5}\cdotp \frac{1}{0.5})^2 \\
                &+\frac{1}{2}\cdotp 0.9\frac{1}{2}\cdotp 0.9\cdot \frac{1}{2}\cdot 0.1(\frac{1}{0.5}\cdotp  \frac{1}{0.5} \cdotp \frac{1}{0.5})^2 \\
                    &+ \cdots \\
                        &=\sum_{t=1}^{\infty}(\frac{1}{2})^{t}0.9^{t-1}0.1((\frac{1}{0.5})^t)^2 \\
                            &=\infty\end{aligned}''')
    st.markdown("### :blue[10.2.6 å¢é‡å¼å®ç°]")
    st.markdown("&emsp;&emsp;å¯ä»¥é€šè¿‡å¢é‡è®¡ç®—æ¥èŠ‚çœå†…å­˜å¹¶ä¸”æé«˜è®¡ç®—é€Ÿåº¦ï¼Œå‡è®¾æˆ‘ä»¬å·²æœ‰æ±‡æŠ¥åºåˆ—$G_1,G_2,....,G_{n-1}$ï¼Œæ¯ä¸€ä¸ªå›æŠ¥éƒ½å¯¹åº”ä¸€ä¸ªéšå³æƒé‡$W_i$ï¼Œé‚£ä¹ˆæœ‰ï¼š")
    st.latex(r'''\begin{aligned}V_{n}&â‰\frac{\sum_{k=1}^{n-1} W_{k} G_{k}}{\sum_{k=1}^{n-1} W_{k}} \\
        V_{n+1}&â‰\frac{\sum_{k=1}^{n-1} W_{k} G_{k}+W_{n}G_{n}}{\sum_{k=1}^{n} W_{k}} \\
            &=\frac{\sum_{k=1}^{n-1} W_{k} G_{k} \frac{\sum_{k=1}^{n-1} W_{k}}{\sum_{k=1}^{n-1} W_{k}} +W_{n}G_{n}}{\sum_{k=1}^{n} W_{k}} \\
                &=\frac{V_nC_{n-1}+W_{n}G_{n}}{C_n}\\
                    &=\frac{V_n(C_{n}-W_n)+W_{n}G_{n}}{C_n} \\
                        &=V_n+\frac{(G_n-V_n)W_n}{C_n}\end{aligned} \tag{10.19}''')
    st.markdown("&emsp;&emsp;ç¦»è½¨ç­–ç•¥çš„ç­–ç•¥è¯„ä¼°ç®—æ³•æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š")
    st.image("src/RL-off-vallue.png")
    st.markdown("&emsp;&emsp;å½“æƒé‡$W$ä¸ä¸º0æ—¶æ‰ä¼šå¾ªç¯ï¼Œå…¶ä¸­$C(S_t,A_t)$å°±ç›¸å½“äºå…¬å¼$10.19$ä¸­çš„$C_n$")
    st.markdown("### :blue[ç¦»è½¨ç­–ç•¥çš„è’™ç‰¹å¡æ´›æ§åˆ¶]")
    st.markdown("&emsp;&emsp;åŠ¨ä½œä»·å€¼çš„ä¼°è®¡ç®—æ³•æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š")
    st.image("src/RL-off-action.png")
    st.markdown("&emsp;&emsp;ç®—æ³•æœ€åä¸€è¡Œçš„çš„é‡‡æ ·æ¯”ä¸º$\\frac{1}{b(A_t|S_t)}$æ˜¯å› ä¸ºcæ­¤æ—¶çš„$\pi$æ˜¯ä¸€ä¸ªç¡®å®šæ€§çš„ç­–ç•¥ã€‚")
    
def reinforcement_gradient_policy():
    st.title("ç­–ç•¥æ¢¯åº¦æ–¹æ³•")
    st.markdown("&emsp;&emsp;åœ¨å¼ºåŒ–å­¦ä¹ ä¸­ï¼Œã€‚ã€‚ã€‚ã€‚")
    st.markdown("## :blue[ç­–ç•¥è¿‘ä¼¼]")
    
def reinforcement_TimeDifference():
    st.markdown("## :blue[10.4 æ—¶åºå·®åˆ†ç®—æ³•]")
    st.markdown("### :blue[10.4.1 TD Prediction]")
    st.markdown("&emsp;&emsp;è®©æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹æ¯æ¬¡è®¿é—®å‹çš„è’™ç‰¹å¡æ´›æ–¹æ³•çš„çŠ¶æ€ä»·å€¼å‡½æ•°ä¼°è®¡ï¼š")
    st.latex(r'''V\left(S_{t}\right) \leftarrow V\left(S_{t}\right)+\alpha\left[G_{t}-V\left(S_{t}\right)\right]''')
    st.markdown("&emsp;&emsp;ä¸Šå¼ä¸­ï¼Œ$G_t$æ˜¯é€šè¿‡ä¸æ–­é‡‡æ ·ï¼Œå³èµ°äº†å¾ˆå¤šæ­¥ä»¥åç®—å‡ºæ¥çš„å€¼ï¼›è’™ç‰¹å¡æ´›æ–¹æ³•å¿…é¡»ç­‰å¾…æ•´å¹•æ•°æ®ç»“æŸä»¥åæ‰ä¼šè¿›è¡Œä¸€æ¬¡æ›´æ–°ã€‚")
    st.markdown("&emsp;&emsp;æœ¬ç« çš„æ—¶åºå·®åˆ†ç®—æ³•$TD(0)$çš„çŠ¶æ€ä»·å€¼æ›´æ–°å…¬å¼ä¸ºï¼š")
    st.latex(r'''V\left(S_{t}\right) \leftarrow V\left(S_{t}\right)+\alpha\left[R_{t+1}+\gamma V\left(S_{t+1}\right)-V\left(S_{t}\right)\right]''')
    st.markdown("&emsp;&emsp;TD(0)çš„æ›´æ–°å…¬å¼çš„å³åŠéƒ¨åˆ†æ‹¬å·å†…å®é™…ä¸Šæ˜¯ä¸€ç§è¯¯å·®ï¼Œè¡¡é‡çš„æ˜¯$S_t$ä¼°è®¡å€¼ä¸$R_t+\\gamma V(S_{t+1})$ä¹‹é—´çš„å·®å¼‚ã€‚è¿™ä¸ªæ•°å€¼ç§°ä½œ$TD$è¯¯å·®ã€‚")
    st.latex(r'''\delta_{t} \doteq R_{t+1}+\gamma V\left(S_{t+1}\right)-V\left(S_{t}\right)''')
    
    st.markdown("### :blue[10.4.2 Advantages of TD Prediction Methods]")
    st.markdown("&emsp;&emsp;æ¥ä¸‹æ¥çœ‹ä¸€ä¸ªé©¬å°”å¯å¤«æ”¶ç›Šè¿‡ç¨‹çš„ä¾‹å­ï¼ˆæ²¡æœ‰åŠ¨ä½œï¼‰ï¼š")
    st.image("src/RL-TD-adv.png")
    st.markdown("&emsp;&emsp;æ ¹æ®çŠ¶æ€å’Œæ”¶ç›Šè½¬ç§»å›¾æˆ‘ä»¬å¯ä»¥åˆ—å‡ºä»¥ä¸‹æ–¹ç¨‹ï¼šï¼ˆ:red[æˆ‘ä»¬ç”¨$P_i$æ¥è¡¨ç¤ºå½“æˆ‘ä»¬å¤„äºçŠ¶æ€ i ä¸‹ï¼Œæœ€ç»ˆèƒ½åˆ°è¾¾å³ç»ˆæ­¢æ€çš„æ¦‚ç‡]ï¼‰")
    st.latex(r'''\left\{\begin{aligned}
P_{a} & =\frac{1}{2} P_{b}+\frac{1}{2} \times 0 \\
P_{b} & =\frac{1}{2} P_{a}+\frac{1}{2} P_{c} \\
P_{c} & =\frac{1}{2} P_{b}+\frac{1}{2} P_{d} \\
P_{d} & =\frac{1}{2} P_{c}+\frac{1}{2} P_{e} \\
P_{e} & =\frac{1}{2} P_{d}+\frac{1}{2} \times 1
\end{aligned}\right. \tag{10.20}''')
    st.latex(r''' \Rightarrow P_{a}=\frac{1}{6}, P_{b}=\frac{2}{6}, P_{c}=\frac{3}{6}, P_{d}=\frac{4}{6}, P_{e}=\frac{5}{6}''')
    st.markdown("&emsp;&emsp;ç”±äºåªæœ‰çŠ¶æ€$E$è½¬ç§»åˆ°ç»ˆæ­¢çŠ¶æ€ä¼šè·å¾—æ”¶ç›Š$+1$ï¼Œå› æ­¤è¿™äº›çŠ¶æ€ä»·å€¼å°±ç­‰äºå¯¹åº”çš„çŠ¶æ€æ¦‚ç‡ã€‚")
    st.markdown("&emsp;&emsp;ä¸‹å›¾å±•ç¤ºäº†æ—¶åºå·®åˆ†æ–¹æ³•å’Œè’™ç‰¹å¡æ´›æ–¹æ³•åœ¨è¯¥ä»»åŠ¡ä¸Šçš„è¡¨ç°ï¼š")
    st.image("src/RL-TD-adv2.png")
    st.markdown("&emsp;&emsp;å·¦å­å›¾æ˜¾ç¤ºçš„æ˜¯$TD$ç®—æ³•åˆ†åˆ«è¿è¡Œ$1ã€10ã€100$æ¬¡åä¸çœŸå®å€¼çš„æ¯”è¾ƒã€‚å¯è§å½“è¿è¡Œ$100$æ¬¡ä»¥åé¢„æµ‹æ•ˆæœå°±ååˆ†æ¥è¿‘çœŸå®å€¼äº†ã€‚å³å­å›¾åˆ™å¯¹æ¯”äº†\
        æ—¶åºå·®åˆ†å’Œè’™ç‰¹å¡æ´›æ–¹æ³•åœ¨ä¸åŒ$\\alpha$å–å€¼ä¸‹çš„è¯¯å·®æ”¶æ•›æƒ…å†µï¼Œå¯ä»¥æ˜æ˜¾è§‚å¯Ÿåˆ°ï¼Œåœ¨è¯¥ä»»åŠ¡ä¸Šï¼Œæ—¶åºå·®åˆ†æ–¹æ³•æ”¶ä¿©é€Ÿåº¦æ˜¾è‘—å¿«äºè’™ç‰¹å¡æ´›æ–¹æ³•ï¼Œä¸”è¯¯å·®æ›´å°ã€‚")
    st.markdown("&emsp;&emsp;$TD$æ–¹æ³•åˆ™åªéœ€ç­‰åˆ°è¿™ä¸€æ­¥ç»“æŸï¼Œåˆ©ç”¨å®æ—¶è§‚æµ‹åˆ°çš„å¥–åŠ±å€¼å’Œç°æœ‰ä¼°è®¡å€¼æ¥è¿›è¡Œæ›´æ–°ã€‚$TD$ç®—æ³•çš„ä¼˜ç‚¹å¦‚ä¸‹ï¼š:blue[1.æ— é¡»çŸ¥é“åŠ¨æ€ç‰¹æ€§ã€‚2.è’™ç‰¹å¡æ´›æ–¹æ³•åœ¨å¹•æ•°å¾ˆé•¿æ—¶æœ‰è¾ƒå¤§çš„å»¶æ—¶é—®é¢˜ï¼ŒTDæ–¹æ³•èƒ½å¤Ÿè§£å†³è¿™ç§é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡åœ¨çº¿ã€å®æ—¶çš„æ–¹å¼è¿›è¡Œå¢é‡æ›´æ–°ã€‚]")
    st.markdown("### :blue[10.4.3 Optimality of TD(0)]")
    st.markdown("### :blue[10.4.4 SARSA: On-policy TD Control]")
    st.markdown("&emsp;&emsp;æ—¶åºå·®åˆ†ç®—æ³•çš„åŠ¨ä½œä»·å€¼ä¼°è®¡æ—¶ï¼Œå¯¹äºåŒè½¨ç­–ç•¥ï¼Œæˆ‘ä»¬éµå¾ªå½“å‰ç­–ç•¥$\pi$ç”Ÿæˆçš„æ•°æ®ï¼ˆçŠ¶æ€$s$å’ŒåŠ¨ä½œ$a$ï¼‰æ¥ä¼°è®¡$q_{\pi}(s,a)$")
    st.image("src/RL-TD-SARSA1.png")
    st.markdown("### :blue[10.4.5 Q-Learning: On-policy TD Control]")
    st.markdown("### :blue[10.4.6 Expected SARSA]")
    pass
def reinforcement_ppo_family():
    st.title("PPO")
    st.markdown("&emsp;&emsp;PPO æ˜¯ä¸€ç§å±äºç­–ç•¥æ¢¯åº¦ç®—æ³•çš„æ”¹è¿›æ–¹æ³•ï¼Œæ—¨åœ¨è§£å†³ä¼ ç»Ÿç­–ç•¥æ¢¯åº¦ç®—æ³•ä¸­çš„ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚æ ·æœ¬æ•ˆç‡å’Œè¿­ä»£ç¨³å®šæ€§ã€‚PPO æå‡ºäº†ä¸€ç§åŸºäºé‡è¦æ€§é‡‡æ ·æ¯”ä¾‹å’Œæˆªæ–­ä¼˜åŒ–çš„ç­–ç•¥æ›´æ–°æ–¹å¼ï¼Œä»¥æé«˜é‡‡æ ·æ•°æ®çš„åˆ©ç”¨æ•ˆç‡ï¼Œå¹¶é€šè¿‡ä¸€å®šçš„é™åˆ¶ç¡®ä¿ç­–ç•¥æ›´æ–°çš„ç¨³å®šæ€§ã€‚")
    
def reinforcement_prev():
    st.title("å¼ºåŒ–å­¦å¯¼è®º")
    
pages={
    "å¼ºåŒ–å­¦ä¹ å¯¼è®º": reinforcement_prev,
    "å¼ºåŒ–å­¦ä¹ åŸºç¡€": reinforcement_foundation,
    "åŠ¨æ€è§„åˆ’": reinforcement_dynamic_programming,
    "è’™ç‰¹å¡æ´›æ–¹æ³•": reinforcement_montecarlo,
    "æ—¶åºå·®åˆ†æ–¹æ³•": reinforcement_TimeDifference,
    "ç­–ç•¥æ¢¯åº¦æ–¹æ³•": reinforcement_gradient_policy,
    "Proximal Policy Optimization": reinforcement_ppo_family
}
# æ·»åŠ ä¾§è¾¹æ èœå•
selection = st.sidebar.radio("å­¦ä¹ åˆ—è¡¨", list(pages.keys()))

# æ ¹æ®é€‰æ‹©çš„èœå•æ˜¾ç¤ºç›¸åº”çš„é¡µé¢
page = pages[selection]
page()